var Re=Object.defineProperty;var Be=(p,t,e)=>t in p?Re(p,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):p[t]=e;var m=(p,t,e)=>Be(p,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const f of a.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&s(f)}).observe(document,{childList:!0,subtree:!0});function e(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(n){if(n.ep)return;n.ep=!0;const a=e(n);fetch(n.href,a)}})();var x=(p=>(p.L="L",p.R="R",p.U="U",p.D="D",p))(x||{});class fe{constructor(t,e){this.key=t,this.value=e}getKey(){return this.key}getValue(){return this.value}static from(t,e){return new fe(t,e)}toString(){return"["+this.getKey()+", "+this.getValue()+"]"}}const Ce=class Ce{static makeMove(t,e){const n=t.indexOf(-1),a=this.getXY(n);let f=a.getKey(),l=a.getValue();e===x.L&&(f-=1),e===x.R&&(f+=1),e===x.U&&(l-=1),e===x.D&&(l+=1);const S=this.getIndex(f,l);if(S>15)throw console.log(t),console.log(e),new Error("i1 > 15");const A=[...t],k=A[S];return A[n]=k,A[S]=-1,A}static getXY(t){const e=t%4,s=Math.floor(t/4);return fe.from(e,s)}static getIndex(t,e){return e*4+t}static _getValidMoves(t){const e=this.getXY(t);let s=Object.values(x).slice();return e.getKey()===0&&(s=s.filter(n=>n!==x.L)),e.getKey()===3&&(s=s.filter(n=>n!==x.R)),e.getValue()===0&&(s=s.filter(n=>n!==x.U)),e.getValue()===3&&(s=s.filter(n=>n!==x.D)),s}static getValidMoves(t,e){let s=this._getValidMoves(t);const n=this.getXY(t);return this.contains(e,n.getKey()-1,n.getValue())&&(s=s.filter(a=>a!=x.L)),this.contains(e,n.getKey()+1,n.getValue())&&(s=s.filter(a=>a!=x.R)),this.contains(e,n.getKey(),n.getValue()-1)&&(s=s.filter(a=>a!=x.U)),this.contains(e,n.getKey(),n.getValue()+1)&&(s=s.filter(a=>a!=x.D)),s}static contains(t,e,s){return t.includes(this.getIndex(e,s))}static getStateAsString(t){let e=t.getBoardState(),s=t.getGoals();return this.zenGardenOn?this.getStateAsZenStoneGarden(e,s):this.__getStateAsString(e,s)}static __getStateAsString(t,e){return Array.from({length:16},(s,n)=>{let a;const f=t[n];return f===-1?a=B.blue("*"):e.includes(f)?a=B.red(f.toString()):e.includes(n+1)?a=B.green(f.toString()):a=f.toString(),a+="	",n!==0&&(n+1)%4===0&&(a+=`
`),a}).join("")}static getStateAsZenStoneGarden(t,e){return Array.from({length:16},(s,n)=>{let a;const f=t[n];return e.includes(f)?a="x":e.includes(n+1)?a="o":a="",a+="	",n!==0&&(n+1)%4===0&&(a+=`
`),a}).join("")}static prntState(t){let e=this.getStateAsString(t);B.prnt(e)}static prntStateV0(t){let e=this.getStateAsString(t);B.prntAtSomeElement("shadowTester",e)}static getReverseAction(t){return t===x.D?x.U:t===x.U?x.D:t===x.L?x.R:t===x.R?x.L:null}static getAction(t,e,s){const n=e.getHashCodeV2();if(t.has(n)){let a=t.get(n);if(a===void 0)throw new Error("qTable.has(hash) == true, but get(..) returned row == undefined");return a.getActionWithMaxValue(s)}else return this.getFirstPossibleAction(e,s)}static getRandomAction(t){return t.length===0&&B.prntErrorMsg("Check lessons configuration, for logic errors: The getPossibleActions function returned no action."),t.length>0?t[Math.floor(Math.random()*t.length)]:x.D}static getFirstPossibleAction(t,e){const s=this.getPossibleActions(t);if(s.length===1)return B.prntErrorMsg("Check lessons configuration, for logic errors: The getPossibleActions function returned only one action: "+s[0]),s[0];const n=s.filter(a=>a!==e);return n.length===0?(B.prntErrorMsg("Check lessons configuration, for logic errors: The getPossibleActions function returned no action."),x.D):n[0]}static getPossibleActions(t){const e=t.getBoardState().indexOf(-1),s=t.getFixedElements().map(n=>n-1);return Ce.getValidMoves(e,s)}};m(Ce,"zenGardenOn",!1);let C=Ce;class B{static blue(t){return'<span style="color: blue;">'+t+"</span>"}static green(t){return'<span style="color: green;">'+t+"</span>"}static red(t){return'<span style="color: red;">'+t+"</span>"}static clearScreen(){const t=document.getElementById("console");t&&(t.innerHTML="")}static prntTestStep(t){this.addElementToConsoleDiv("testGameStep",t)}static prntAtSomeElement(t,e){this.addElementToConsoleDiv(t,e)}static prntStatsInfo(t){const e=document.getElementById("statsInfo");e&&(e.setAttribute("class","console-text"),e.textContent=`
`+t.toLowerCase().replace(", "," | "))}static prntErrorMsg(t){if(C.zenGardenOn)return;const e=document.getElementById("statsInfo");e&&(e.setAttribute("class","console-error-msg"),e.textContent=`
`+t)}static addElementToConsoleDiv(t,e){const s=document.getElementById(t);s?s.innerHTML=e:this.prnt(e,"color:black;",t)}static prnt(t,e="color:black;",s=null){const n=document.getElementById("console");if(n){const a=document.createElement("div");a.innerHTML=t,e&&(a.style.cssText=e),s!==null&&(a.id=s),n.appendChild(a),n.scrollTop=n.scrollHeight}}static warn(t){this.prnt(t,"color: orange;")}}const ke=class ke{static prnt(t,e="color: black;"){B.prnt(t,e)}static str(t,e){const s=t.toString();if(s.length>=e)return s;const n=e-s.length;return s+ke.emptyString.substring(0,n)}static sum(t){return!t||(t=t.filter(e=>e!==0),t.length===0)?0:t.reduce((e,s)=>e+s,0)}static toString(t){return`[${Array.from(t).map(String).join(", ")}]`}static px(){return(t,e)=>t}static equalArrays(t,e){if(t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(t[s]!==e[s])return!1;return!0}static shuffleArray(t){return t.sort(()=>Math.random()-.5)}static _sleep(t){return new Promise(e=>setTimeout(e,t))}static async sleep(t){await this._sleep(t)}};m(ke,"emptyString","                                           ");let H=ke;class ze{constructor(t){m(this,"state");m(this,"qValues");this.state=t,this.qValues=new Map}setValue(t,e){const s=C.getPossibleActions(this.state);this.qValues.size===0&&s.forEach(n=>this.qValues.set(n,0)),s.includes(t)&&this.qValues.set(t,e)}getState(){return this.state}getValue(t){return this.qValues.get(t)||0}getActionWithMaxValue(t){const e=t===null?null:this.getAction(t);if(e==null){let s=C.getPossibleActions(this.state);if(s=s.filter(n=>n!==t),s.length===0)throw B.prntErrorMsg("possibleActions.length === 0, there allways must be some action to go around.. need to debug."),new Error("possibleActions.length === 0, there allways must be some action to go around.. need to debug.");return s[0]}else return e}getAction(t){const s=Array.from(this.qValues.entries()).filter(([n])=>n!==t).reduce((n,a)=>a[1]>n[1]?a:n,[t,-1/0]);return s[1]>-1/0?s[0]:void 0}getMaxValue(){return this.qValues.size===0?0:Math.max(...Array.from(this.qValues.values()))}}class Ge{static updateQTable(t,e,s,n,a,f,l,S){let A;if(f)A=a;else{const k=this.getQValue(t,e,s),G=this.getMaxQValue(t,n);A=this.calcQValue(a,k,G,S,l)}this.addStateWithZeroValuesToQTableIfStateNotExist(t,e),this.updateQTableEntry(t,e.getHashCodeV2(),s,A)}static updateQTableEntry(t,e,s,n){var a;(a=t.get(e))==null||a.setValue(s,n)}static getMaxQValue(t,e){var n;const s=e.getHashCodeV2();return this.addStateWithZeroValuesToQTableIfStateNotExist(t,e),((n=t.get(s))==null?void 0:n.getMaxValue())??0}static getQValue(t,e,s){var a;const n=e.getHashCodeV2();return this.addStateWithZeroValuesToQTableIfStateNotExist(t,e),((a=t.get(n))==null?void 0:a.getValue(s))??0}static addStateWithZeroValuesToQTableIfStateNotExist(t,e){t.has(e.getHashCodeV2())||this.addStateWithZeroValuesToQTable(t,e)}static addStateWithZeroValuesToQTable(t,e){const s=e.getHashCodeV2(),n=new ze(e);t.set(s,n)}static calcQValue(t,e,s,n,a){return e+a*(t+n*s-e)}}class le{static shuffle(t,e,s){const n=e.map(a=>a-1);for(let a=0;a<s;a++)t=le.makeRandomMove(t,n);return t}static makeRandomMove(t,e){const s=t.indexOf(-1),n=C.getValidMoves(s,e),a=H.shuffleArray(n)[0];return C.makeMove(t,a)}static shuffleForTraining(t){const e=Array.from({length:16},(f,l)=>l+1).filter(f=>!t.includes(f)),s=[...e].sort(()=>Math.random()-.5),n=e.map((f,l)=>fe.from(f,s[l]));return Array.from({length:16},(f,l)=>this.zip(n,l)).map(f=>f.getValue()===16?-1:f.getValue())}static zip(t,e){const s=t.find(n=>n.getKey()===e+1);return s===void 0?fe.from(e,e+1):fe.from(e,s.getValue())}}class U{constructor(t,e){m(this,"boardState");m(this,"goals");m(this,"fixedElements");"boardState"in t&&"goals"in t&&"fixedElements"in t?(this.boardState=[...t.boardState],this.goals=[...t.goals],this.fixedElements=[...t.fixedElements]):t instanceof U?(this.boardState=[...t.getBoardState()],this.goals=[...t.getGoals()],this.fixedElements=[...t.getFixedElements()]):(this.boardState=[...t],this.goals=[...(e==null?void 0:e.getGoals())??[]],this.fixedElements=[...(e==null?void 0:e.getLockedStateElements())??[]])}static getTestCase(){let t={boardState:[1,2,3,4,5,6,7,8,9,10,11,-1,14,15,12,13],goals:[12],fixedElements:[1,2,3,4,5,6,7,8,9,10,11,13,14,15]};return new U(t)}getBoardState(){return this.boardState}setBoardState(t){this.boardState=t}getGoals(){return this.goals}setGoals(t){this.goals=t}getFixedElements(){return this.fixedElements}setFixedElements(t){this.fixedElements=t}getHashCodeV2(){const t=this.getHashCodeV3__();return this.hashString(t)}getHashCodeV3__(){return Array.from({length:16},(t,e)=>{let s;const n=this.boardState[e];return n===-1?s="*":this.goals.includes(n)?s=String(n):this.goals.includes(e+1)?s="o":s=" ",s=s+"	",e!==0&&(e+1)%4===0&&(s=s+`
`),s}).join("")}getHashCode(){const t=this.boardState.map(String).join(",");return this.hashString(t)}hashString(t){let e=0;for(let s=0;s<t.length;s++){const n=t.charCodeAt(s);e=(e<<5)-e+n,e|=0}return e}equals(t){return this.getHashCode()===t.getHashCode()}hashCode(){return this.getHashCode()}}class He{constructor(t,e,s=0,n=!1){m(this,"state");m(this,"action");m(this,"reward");m(this,"isTerminal");this.state=t,this.action=e,this.reward=s,this.isTerminal=n}}const z=class z{constructor(t){m(this,"state");m(this,"goals");m(this,"reverseAction",null);m(this,"bigCircleAction1",[]);m(this,"bigCircleAction2",[]);m(this,"smallCircleAction1",[]);m(this,"smallCircleAction2",[]);m(this,"circleAction",[]);z.stateProducer=t,z.stateProducer.resetState().then();const e=z.stateProducer.getState();this.goals=z.stateProducer.getGoals(),this.state=new U(e,z.stateProducer)}static isTerminalSuccess(t){return z._isTerminalSuccess(t.getBoardState(),t.getGoals())}reset(){this.reverseAction=null,this.circleAction=[],this.bigCircleAction1=[],this.bigCircleAction2=[],this.smallCircleAction1=[],this.smallCircleAction2=[],this.bigCircleAction1.push(x.L,x.L,x.D,x.D,x.R,x.R,x.U,x.U),this.bigCircleAction2.push(x.R,x.R,x.D,x.D,x.L,x.L,x.U,x.U),this.smallCircleAction1.push(x.L,x.D,x.R,x.U,x.L),this.smallCircleAction2.push(x.R,x.D,x.L,x.U,x.R)}getInitState(){z.stateProducer.resetState();const t=z.stateProducer.getState();return this.goals=z.stateProducer.getGoals(),this.state=new U(t,z.stateProducer),this.state}executeAction(t,e){const s=C.makeMove(t.getBoardState(),e),n=new U(s,z.stateProducer);let a=z._isTerminalSuccess(s,this.goals);this.state=new U(s,z.stateProducer);let f=NaN;this.reverseAction=C.getReverseAction(e),this.circleAction.push(e),this.circleAction.length>8&&this.circleAction.shift(),(H.equalArrays(this.circleAction,this.bigCircleAction1)||H.equalArrays(this.circleAction,this.bigCircleAction2)||H.equalArrays(this.circleAction,this.smallCircleAction1)||H.equalArrays(this.circleAction,this.smallCircleAction2))&&(a=!0);const l=this.state.getBoardState().indexOf(-1);return z.stateProducer.isLockedIndex(l)&&(a=!0,f=-1),isNaN(f)&&(f=this.getReward(s,this.goals)),new He(n,e,f,a)}static _isTerminalSuccess(t,e){return e.filter(n=>t[n-1]===n).length===e.length}prntInfo(){H.prnt(`

------------------------------------------------------------------
`);const t=this.state.getBoardState(),e=t.indexOf(-1),s=C.getXY(e);H.prnt(s.getKey()+" - "+s.getValue());const n=C.getIndex(s.getKey(),s.getValue());H.prnt(`${e} - ${n}`);const a=C._getValidMoves(e);H.prnt(a);const f=this.getReward(t,this.goals);H.prnt("reward: "+f),H.prnt(`
`),C.prntState(this.state)}getReward(t,e){const s=t.indexOf(-1),n=C.getXY(s),f=e.map(S=>this.getDistance(C.getXY(t.indexOf(S)),C.getXY(S-1))).reduce((S,A)=>S+A,0);if(f===0)return 100.5;const l=e.reduce((S,A)=>S+this.getDistance(C.getXY(t.indexOf(A)),n),0);return 1/(f+l)}getDistance(t,e){const s=Math.pow(e.getKey()-t.getKey(),2),n=Math.pow(e.getValue()-t.getValue(),2);return Math.sqrt(s+n)}};m(z,"stateProducer");let he=z;class pe{static async getFile(t){let e="";try{const s=await fetch(t);if(!s.ok)throw new Error(`HTTP error! Status: ${s.status}`);e=await s.text()}catch(s){console.error("Error reading file: "+t,s)}finally{return e}}}const ye=class ye{static async getConfiguration(){var e;if(this.configuration!==void 0)return this.configuration;let t=await this.getConfigurationJson();try{return this.configuration=JSON.parse(t),this.configuration.lessons=(e=this.configuration.lessons)==null?void 0:e.sort((s,n)=>s.lesson-n.lesson),this.configuration}catch(s){return console.error("Invalid JSON string:",s),this.configuration={}}}static async getConfigurationJson(){if(this.configurationJson!==void 0)return this.configurationJson;const t="dist/configuration.json",e="/public/configuration.json";return this.configurationJson=await pe.getFile(t),this.configurationJson===""?await pe.getFile(e):this.configurationJson}static async updateConfigurationJson(t){var e;try{let s=JSON.parse(t);return this.configuration.lessons=(e=this.configuration.lessons)==null?void 0:e.sort((n,a)=>n.lesson-a.lesson),this.configurationJson=t,this.configuration=s,await ye.updateTester(),await Z.restartTrainerIfIsRunning(),{success:!0,messgae:"Configuration updated successfully."}}catch(s){return console.error("Invalid JSON string:",s),{success:!1,messgae:"Invalid JSON string: "+s}}}static async updateTester(){const t=this.configuration.usePretrainedDataWhileTesting;Ee.usePreloadedActions!==t&&await Z.restartTesterIfIsRunning()}};m(ye,"configurationJson"),m(ye,"configuration");let ce=ye;const g=class g{constructor(t){m(this,"goals");m(this,"lockedStateElements");m(this,"state");m(this,"episodesToTrain");m(this,"lessonNb");this.lessonNb=t,this.goals=[],this.lockedStateElements=[],this.state=[],this.episodesToTrain=0}getState(){return this.state}getGoals(){return this.goals}getLockedStateElements(){return this.lockedStateElements}getEpisodesToTrain(){return this.episodesToTrain}static async getLessonProducersFromJson(){var s;let t=await ce.getConfiguration();if(t.lessons===void 0)return[];const e=((s=t.basicTrainerConfig)==null?void 0:s.lessonsToGenerate)??100;return t.lessons.map((n,a)=>g.from(n,a,e))}static from(t,e,s){const n=new g(e);return n.goals=t.goals,n.lockedStateElements=t.lockedElements!==void 0?t.lockedElements:[],n.episodesToTrain=t.lessonsToGenerate!==void 0?t.lessonsToGenerate:s,n.state=le.shuffleForTraining(n.lockedStateElements),t.startPositions===void 0?n:g.shuffleFreeCellStarPosition(n,t.startPositions.map(a=>a-1))}static generateLessons0(){return[g.state1(0),g.shuffleFreeCellStarPosition(g.createStateProducer(2,1),[1,4]),g.shuffleFreeCellStarPosition(g.createStateProducer(3,2),[2,5]),g.shuffleFreeCellStarPosition(g.createStateProducerForGoals_3_4(3),[3,6]),g.shuffleFreeCellStarPosition(g.createStateProducer(5,4),[6,7]),g.shuffleFreeCellStarPosition(g.createStateProducer(6,5),[5,8]),g.shuffleFreeCellStarPosition(g.createStateProducer(7,6),[6,9]),g.shuffleFreeCellStarPosition(g.createStateProducerForGoals_7_8(7),[8,11]),g.shuffleFreeCellStarPosition(g.createStateProducerForGoals_9_13(8),[10,11]),g.shuffleFreeCellStarPosition(g.createStateProducerForGoals_10__15(9),[9,13]),g.state12(10)]}static generateLessonsV1(){return[g.createStateProducerForGoals_1_2(0),g.shuffleFreeCellStarPosition(g.createStateProducerForGoals_3_4(1),[2,3,4]),g.shuffleFreeCellStarPosition(g.createStateProducer(5,2),[6,7]),g.shuffleFreeCellStarPosition(g.createStateProducer(6,3),[5,8]),g.shuffleFreeCellStarPosition(g.createStateProducer(7,4),[6,9]),g.shuffleFreeCellStarPosition(g.createStateProducerForGoals_7_8(5),[8,11]),g.shuffleFreeCellStarPosition(g.createStateProducerForGoals_9_13(6),[10,11]),g.shuffleFreeCellStarPosition(g.createStateProducerForGoals_10__15(7),[9,13]),g.state12(8)]}static generateLessons(){return[g.createStateProducerForGoals_1_2(0),g.shuffleFreeCellStarPosition(g.createStateProducerForGoals_3_4(1),[2,3,4]),g.shuffleFreeCellStarPosition(g.createStateProducerForGoals_5_6(2),[6,7]),g.shuffleFreeCellStarPosition(g.createStateProducerForGoals_7_8(3),[8,9,6]),g.shuffleFreeCellStarPosition(g.createStateProducerForGoals_9_13(4),[10,11]),g.shuffleFreeCellStarPosition(g.createStateProducerForGoals_10__15(5),[9,13]),g.state12(6)]}static createStateProducerForGoals_1_2(t){const e=new g(t);return e.goals=[1,2],e.lockedStateElements=[],e.state=[...g.stateDone],e.episodesToTrain=100,g.shuffle(e,e.lockedStateElements),e}static state1(t){return g.createStateProducer(1,t)}static createStateProducerForGoals_3_4(t){const e=new g(t);return e.goals=[3,4],e.lockedStateElements=[1,2],e.state=[...g.stateDone],e.episodesToTrain=100,g.shuffle(e,[1,2,3]),e}static createStateProducerForGoals_5_6(t){const e=new g(t);return e.goals=[5,6],e.lockedStateElements=[1,2,3,4],e.state=[...g.stateDone],e.episodesToTrain=100,g.shuffle(e,e.lockedStateElements),e}static createStateProducer(t,e){const s=new g(e);return s.goals=[t],s.lockedStateElements=Array.from({length:t-1},(n,a)=>a+1),s.state=[...g.stateDone],s.episodesToTrain=100,g.shuffle(s,s.lockedStateElements),s}static shuffleFreeCellStarPosition(t,e){const s=H.shuffleArray(e)[0],n=t.state.indexOf(-1),a=t.state[s];return t.state[s]=-1,t.state[n]=a,t}static createStateProducerForGoals_7_8(t){const e=new g(t);return e.goals=[7,8],e.lockedStateElements=[1,2,3,4,5,6],e.state=[...g.stateDone],e.episodesToTrain=100,g.shuffle(e,[1,2,3,4,5,6,7]),e}static createStateProducerForGoals_9_13(t){const e=new g(t);return e.goals=[9,13],e.lockedStateElements=[1,2,3,4,5,6,7,8],e.state=[...g.stateDone],e.episodesToTrain=100,g.shuffle(e,e.lockedStateElements),e}static createStateProducerForGoals_10__15(t){const e=new g(t);return e.goals=[10,11,14,15],e.lockedStateElements=[1,2,3,4,5,6,7,8,9,13],e.state=le.shuffle([...g.stateDone],e.lockedStateElements,this.shufleSteps),e.episodesToTrain=100,e}static state12(t){const e=new g(t);return e.goals=[12],e.lockedStateElements=[1,2,3,4,5,6,7,8,9,10,11,13,14,15],e.state=le.shuffle([...g.stateDone],e.lockedStateElements,this.shufleSteps),e.episodesToTrain=10,e}isLockedIndex(t){return this.lockedStateElements.includes(t+1)}static shuffle(t,e){let s=t.state.filter(n=>!e.includes(n));s=H.shuffleArray(s),t.state=[...e,...s]}resetStateV0(){const t=g.generateLessons()[this.lessonNb];this.goals=[...t.goals],this.lockedStateElements=[...t.lockedStateElements],this.state=[...t.state]}async resetState(){const e=(await g.getLessonProducersFromJson())[this.lessonNb];this.goals=[...e.goals],this.lockedStateElements=[...e.lockedStateElements],this.state=[...e.state]}};m(g,"stateDone",[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,-1]),m(g,"shufleSteps",100);let ue=g;class De{static async getQTableActionMap(){const t="dist/qTableActions.csv",e="/public/qTableActions.csv";let s=await pe.getFile(t);s=s===""?await pe.getFile(e):s;const n=s.trim().split(`
`),a=new Map;return n.forEach(f=>{const[l,S]=f.trim().split(",");a.set(l,x[S])}),a}static getStateActionKey(t){const e=t.getBoardState(),s=t.getGoals();return Array.from({length:16},(a,f)=>{let l;const S=e[f];return S===-1?l="*":s.includes(S)?l=`${S}`:s.includes(f+1)?l="o":l=" ",l+="_",f!==0&&(f+1)%4===0&&(l+="|"),l}).join("").trim()}}const ie=class ie{async test(t){this.stop();const e=new Ee;await e.init(t),e.makeMove(),ie.testerIntervalId=setInterval(()=>e.makeMove(),500)}stop(){ie.testerIntervalId!==null&&(clearInterval(ie.testerIntervalId),ie.testerIntervalId=null)}};m(ie,"testerIntervalId",null);let Ae=ie;class Je{constructor(t){m(this,"lessonNo",0);m(this,"lessons");m(this,"lessonCount");m(this,"stateProducer");m(this,"state");m(this,"goals");m(this,"gameOver",!1);m(this,"step",0);m(this,"reverseAction",null);this.lessons=t,this.lessonCount=t.length,this.stateProducer=t[this.lessonNo];let e=le.shuffle(ue.stateDone,[],1e3);this.state=new U(e,this.stateProducer),this.goals=this.stateProducer.getGoals()}resetIfGameIsOver(){if(!this.gameOver)return;this.lessonNo=0,this.stateProducer=this.lessons[this.lessonNo];let t=le.shuffle(ue.stateDone,[],1e3);this.state=new U(t,this.stateProducer),this.goals=this.stateProducer.getGoals(),this.gameOver=!1,this.step=0,this.reverseAction=null}}const ee=class ee{constructor(){m(this,"ctx",null);m(this,"maxEpisodeSteps",200)}async init(t){const e=await ue.getLessonProducersFromJson();this.ctx=new Je(e),await this.loadedActionMap(t)}async loadedActionMap(t){const e=await ce.getConfiguration();ee.usePreloadedActions=t??e.usePretrainedDataWhileTesting??!0,ee.usePreloadedActions&&ee.actionMap===null&&(ee.actionMap=await De.getQTableActionMap())}makeMove(){if(this.ctx===null)return;this.ctx.gameOver=this.isGameDone(this.ctx.state),this.ctx.resetIfGameIsOver(),this.ctx.step++;let t=this.getAction(this.ctx.state,this.ctx.reverseAction);this.ctx.reverseAction=C.getReverseAction(t);const e=C.makeMove(this.ctx.state.getBoardState(),t),s=he._isTerminalSuccess(e,this.ctx.goals);if(this.ctx.state=new U(e,this.ctx.stateProducer),this.ctx.gameOver=this.isGameDone(this.ctx.state),this.ctx.gameOver=this.ctx.step>this.maxEpisodeSteps,this.prntState(this.ctx.state,this.ctx.step),s&&!this.ctx.gameOver&&this.ctx.lessonNo<this.ctx.lessonCount-1&&(this.ctx.lessonNo++,this.ctx.stateProducer=this.ctx.lessons[this.ctx.lessonNo],this.ctx.goals=this.ctx.stateProducer.getGoals(),this.ctx.state=new U(this.ctx.state.getBoardState(),this.ctx.stateProducer)),s&&this.ctx.gameOver&&this.ctx.lessonNo===this.ctx.lessonCount-1){const n=he.isTerminalSuccess(this.ctx.state)?"success":"failed";this.prntTerminalState(this.ctx.state,this.ctx.step,n)}this.ctx.resetIfGameIsOver()}getAction(t,e){return ee.usePreloadedActions?this.getActionFromActionMap(t,e):this.getActionFromQTable(t,e)}getActionFromQTable(t,e){const s=Z.qTable,n=t.getHashCodeV2();Ge.addStateWithZeroValuesToQTableIfStateNotExist(s,t);const a=s.get(n);return a?a.getActionWithMaxValue(e):(B.prntErrorMsg("no action found"),C.getFirstPossibleAction(t,e))}getActionFromActionMap(t,e){const s=ee.actionMap;let n=De.getStateActionKey(t);if(s!=null&&s.has(n)){let a=s.get(n);return a===void 0&&B.prntErrorMsg("no action found"),a===void 0?C.getFirstPossibleAction(t,e):a}else{let a=C.getFirstPossibleAction(t,e);return B.prntErrorMsg("no action was found for state, first posible action is: "+a),a}}isGameDone(t){return H.equalArrays(t.getBoardState(),ue.stateDone)}prntState(t,e){this.prntTerminalState(t,e,null)}prntTerminalState(t,e,s){let n=C.zenGardenOn?"":`${e}
----
`,a=C.getStateAsString(t),f=C.zenGardenOn||s===null?"":`
----
${s}`;B.prntAtSomeElement("shadowTester",n+a+f)}};m(ee,"usePreloadedActions",!1),m(ee,"actionMap",null);let Ee=ee;class qe{constructor(){m(this,"enabled",!0);m(this,"id",0)}enable(){return this.id++,this.enabled=!0,this.id}stop(){this.enabled=!1}isEnabled(){return this.enabled}goodToGo(t){return!(!this.enabled||t!==this.id)}}class Oe{constructor(t,e,s,n,a){m(this,"state");m(this,"action");m(this,"reward");m(this,"done");m(this,"newState");this.state=new U(t),this.action=e,this.reward=s,this.done=n,this.newState=new U(a)}getState(){return this.state}getAction(){return this.action}getReward(){return this.reward}isDone(){return this.done}getNewState(){return this.newState}equals(t){return t instanceof Oe?this.hashCode()===t.hashCode():!1}hashCode(){return this.state.getHashCodeV2()^this.newState.getHashCodeV2()}}const se=class se{constructor(){m(this,"maxExperienceSize",2e3)}async train(t,e,s,n,a){if(!Se.semaphore.goodToGo(a))return;const f=Z.qTable,l=new he(t);l.reset();let S=l.getInitState();const A=.5;let k=!1,G=0;for(;!k&&G<50;){if(!Se.semaphore.goodToGo(a))return;if(G++,he._isTerminalSuccess(S.getBoardState(),S.getGoals()))break;let J;const P=C.getPossibleActions(S);if(l.reverseAction!==null){const c=P.indexOf(l.reverseAction);P.splice(c,1)}Math.random()<A?J=C.getRandomAction(P):J=C.getAction(f,S,l.reverseAction);const F=l.executeAction(S,J),D=F.state,o=F.reward;k=F.isTerminal;const i=new Oe(S,J,o,k,D);se.experience.add(i),S=F.state}se.replayExperience(se.experience,f,s,e,this.maxExperienceSize),se.experience.size>this.maxExperienceSize&&se.experience.clear();const M=`QTable size: ${f.size}, experience size: ${se.experience.size}`;let $=`
`+n+`
`+M;B.prntAtSomeElement("episodeTrainer",$),B.prntStatsInfo(M+`
it will start to show some intelligence when the qtable size is around 8500 .. ;)`),await H.sleep(0)}static replayExperience(t,e,s,n,a){Array.from(t).sort(()=>Math.random()-.5).slice(0,a).forEach(l=>{Ge.updateQTable(e,l.getState(),l.getAction(),l.getNewState(),l.getReward(),l.isDone(),s,n)})}};m(se,"experience",new Set);let Fe=se;const de=class de{constructor(){m(this,"episodeTrainer",new Fe);m(this,"semaphoreId",null);m(this,"tester",null)}async train(){if(this.semaphoreId=de.semaphore.enable(),!de.semaphore.goodToGo(this.semaphoreId))return;await this.runTester(),Fe.experience.clear();const e=(await ce.getConfiguration()).basicTrainerConfig,s=(e==null?void 0:e.discount)??.9,n=(e==null?void 0:e.learningRate)??.1,a=(e==null?void 0:e.trainingBachCount)??10,f=await ue.getLessonProducersFromJson(),l=async(A,k)=>await this.episodeTrainer.train(A,s,n,k,this.semaphoreId),S=async(A,k,G)=>{let M=A.getEpisodesToTrain();for(let $=0;$<M;$++){let J=k+"Episode: "+($+1)+" of "+M+`
`+G;await l(A,J)}};for(let A=0;A<a;A++)for(let k=0;k<f.length;k++){let G=f[k],M="Lesson: "+(k+1)+" of "+f.length+`.
`,$="Running training batch: "+(A+1)+" of "+a;await S(G,M,$)}}async runTester(){this.tester=new Ae,await this.tester.test(!1)}stop(){var t;de.semaphore.stop(),(t=this.tester)==null||t.stop(),this.tester=null}};m(de,"semaphore",new qe);let Se=de;class Z{static async train(){this.trainer=new Se,await this.trainer.train()}static async test(){this.tester=new Ae,await this.tester.test(void 0)}static async stopTrainer(){var t;(t=this.trainer)==null||t.stop(),this.trainer=null}static async stopTester(){var t;(t=this.tester)==null||t.stop(),this.tester=null}static async restartTesterIfIsRunning(){this.tester!==null&&(await this.stopTester(),await this.test())}static async restartTrainerIfIsRunning(){this.trainer!==null&&(await this.stopTrainer(),await this.train())}}m(Z,"qTable",new Map),m(Z,"trainer",null),m(Z,"tester",null);const je=window;function Ue(p,t,e={}){const s={tab:"	",indentOn:/[({\[]$/,moveToNewLine:/^[)}\]]/,spellcheck:!1,catchTab:!0,preserveIdent:!0,addClosing:!0,history:!0,window:je,...e},n=s.window,a=n.document,f=[],l=[];let S=-1,A=!1,k=()=>{},G;p.setAttribute("contenteditable","plaintext-only"),p.setAttribute("spellcheck",s.spellcheck?"true":"false"),p.style.outline="none",p.style.overflowWrap="break-word",p.style.overflowY="auto",p.style.whiteSpace="pre-wrap";const M=(r,u)=>{t(r,u)};let $=!1;p.contentEditable!=="plaintext-only"&&($=!0),$&&p.setAttribute("contenteditable","true");const J=xe(()=>{const r=i();M(p,r),c(r)},30);let P=!1;const F=r=>!L(r)&&!q(r)&&r.key!=="Meta"&&r.key!=="Control"&&r.key!=="Alt"&&!r.key.startsWith("Arrow"),D=xe(r=>{F(r)&&(Y(),P=!1)},300),o=(r,u)=>{f.push([r,u]),p.addEventListener(r,u)};o("keydown",r=>{r.defaultPrevented||(G=Q(),s.preserveIdent?E(r):v(r),s.catchTab&&R(r),s.addClosing&&I(r),s.history&&(X(r),F(r)&&!P&&(Y(),P=!0)),$&&!ae(r)&&c(i()))}),o("keyup",r=>{r.defaultPrevented||r.isComposing||(G!==Q()&&J(),D(r),k(Q()))}),o("focus",r=>{A=!0}),o("blur",r=>{A=!1}),o("paste",r=>{Y(),be(r),Y(),k(Q())}),o("cut",r=>{Y(),Pe(r),Y(),k(Q())});function i(){const r=W(),u={start:0,end:0,dir:void 0};let{anchorNode:y,anchorOffset:w,focusNode:T,focusOffset:O}=r;if(!y||!T)throw"error1";if(y===p&&T===p)return u.start=w>0&&p.textContent?p.textContent.length:0,u.end=O>0&&p.textContent?p.textContent.length:0,u.dir=O>=w?"->":"<-",u;if(y.nodeType===Node.ELEMENT_NODE){const V=a.createTextNode("");y.insertBefore(V,y.childNodes[w]),y=V,w=0}if(T.nodeType===Node.ELEMENT_NODE){const V=a.createTextNode("");T.insertBefore(V,T.childNodes[O]),T=V,O=0}return we(p,V=>{if(V===y&&V===T)return u.start+=w,u.end+=O,u.dir=w<=O?"->":"<-","stop";if(V===y)if(u.start+=w,!u.dir)u.dir="->";else return"stop";else if(V===T)if(u.end+=O,!u.dir)u.dir="<-";else return"stop";V.nodeType===Node.TEXT_NODE&&(u.dir!="->"&&(u.start+=V.nodeValue.length),u.dir!="<-"&&(u.end+=V.nodeValue.length))}),p.normalize(),u}function c(r){var Ie,Me;const u=W();let y,w=0,T,O=0;if(r.dir||(r.dir="->"),r.start<0&&(r.start=0),r.end<0&&(r.end=0),r.dir=="<-"){const{start:_,end:te}=r;r.start=te,r.end=_}let V=0;we(p,_=>{if(_.nodeType!==Node.TEXT_NODE)return;const te=(_.nodeValue||"").length;if(V+te>r.start&&(y||(y=_,w=r.start-V),V+te>r.end))return T=_,O=r.end-V,"stop";V+=te}),y||(y=p,w=p.childNodes.length),T||(T=p,O=p.childNodes.length),r.dir=="<-"&&([y,w,T,O]=[T,O,y,w]);{const _=d(y);if(_){const me=a.createTextNode("");(Ie=_.parentNode)==null||Ie.insertBefore(me,_),y=me,w=0}const te=d(T);if(te){const me=a.createTextNode("");(Me=te.parentNode)==null||Me.insertBefore(me,te),T=me,O=0}}u.setBaseAndExtent(y,w,T,O),p.normalize()}function d(r){for(;r&&r!==p;){if(r.nodeType===Node.ELEMENT_NODE){const u=r;if(u.getAttribute("contenteditable")=="false")return u}r=r.parentNode}}function h(){const u=W().getRangeAt(0),y=a.createRange();return y.selectNodeContents(p),y.setEnd(u.startContainer,u.startOffset),y.toString()}function b(){const u=W().getRangeAt(0),y=a.createRange();return y.selectNodeContents(p),y.setStart(u.endContainer,u.endOffset),y.toString()}function E(r){if(r.key==="Enter"){const u=h(),y=b();let[w]=K(u),T=w;if(s.indentOn.test(u)&&(T+=s.tab),T.length>0?(j(r),r.stopPropagation(),N(`
`+T)):v(r),T!==w&&s.moveToNewLine.test(y)){const O=i();N(`
`+w),c(O)}}}function v(r){if($&&r.key==="Enter")if(j(r),r.stopPropagation(),b()==""){N(`
 `);const u=i();u.start=--u.end,c(u)}else N(`
`)}function I(r){const u=`([{'"`,y=`)]}'"`;if(u.includes(r.key)){j(r);const w=i(),T=w.start==w.end?"":W().toString(),O=r.key+T+y[u.indexOf(r.key)];N(O),w.start++,w.end++,c(w)}}function R(r){if(r.key==="Tab")if(j(r),r.shiftKey){const u=h();let[y,w]=K(u);if(y.length>0){const T=i(),O=Math.min(s.tab.length,y.length);c({start:w,end:w+O}),a.execCommand("delete"),T.start-=O,T.end-=O,c(T)}}else N(s.tab)}function X(r){if(L(r)){j(r),S--;const u=l[S];u&&(p.innerHTML=u.html,c(u.pos)),S<0&&(S=0)}if(q(r)){j(r),S++;const u=l[S];u&&(p.innerHTML=u.html,c(u.pos)),S>=l.length&&S--}}function Y(){if(!A)return;const r=p.innerHTML,u=i(),y=l[S];if(y&&y.html===r&&y.pos.start===u.start&&y.pos.end===u.end)return;S++,l[S]={html:r,pos:u},l.splice(S+1);const w=300;S>w&&(S=w,l.splice(0,1))}function be(r){if(r.defaultPrevented)return;j(r);const y=(r.originalEvent??r).clipboardData.getData("text/plain").replace(/\r\n?/g,`
`),w=i();N(y),M(p),c({start:Math.min(w.start,w.end)+y.length,end:Math.min(w.start,w.end)+y.length,dir:"<-"})}function Pe(r){const u=i(),y=W();(r.originalEvent??r).clipboardData.setData("text/plain",y.toString()),a.execCommand("delete"),M(p),c({start:Math.min(u.start,u.end),end:Math.min(u.start,u.end),dir:"<-"}),j(r)}function we(r,u){const y=[];r.firstChild&&y.push(r.firstChild);let w=y.pop();for(;w&&u(w)!=="stop";)w.nextSibling&&y.push(w.nextSibling),w.firstChild&&y.push(w.firstChild),w=y.pop()}function ge(r){return r.metaKey||r.ctrlKey}function L(r){return ge(r)&&!r.shiftKey&&re(r)==="Z"}function q(r){return ge(r)&&r.shiftKey&&re(r)==="Z"}function ae(r){return ge(r)&&re(r)==="C"}function re(r){let u=r.key||r.keyCode||r.which;if(u)return(typeof u=="string"?u:String.fromCharCode(u)).toUpperCase()}function N(r){r=r.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),a.execCommand("insertHTML",!1,r)}function xe(r,u){let y=0;return(...w)=>{clearTimeout(y),y=n.setTimeout(()=>r(...w),u)}}function K(r){let u=r.length-1;for(;u>=0&&r[u]!==`
`;)u--;u++;let y=u;for(;y<r.length&&/[ \t]/.test(r[y]);)y++;return[r.substring(u,y)||"",u,y]}function Q(){return p.textContent||""}function j(r){r.preventDefault()}function W(){var r;return((r=p.parentNode)==null?void 0:r.nodeType)==Node.DOCUMENT_FRAGMENT_NODE?p.parentNode.getSelection():n.getSelection()}return{updateOptions(r){Object.assign(s,r)},updateCode(r){p.textContent=r,M(p),k(r)},onUpdate(r){k=r},toString:Q,save:i,restore:c,recordHistory:Y,destroy(){for(let[r,u]of f)p.removeEventListener(r,u)}}}var Le=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},$e={exports:{}};(function(p){var t=typeof window<"u"?window:typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?self:{};/**
 * Prism: Lightweight, robust, elegant syntax highlighting
 *
 * @license MIT <https://opensource.org/licenses/MIT>
 * @author Lea Verou <https://lea.verou.me>
 * @namespace
 * @public
 */var e=function(s){var n=/(?:^|\s)lang(?:uage)?-([\w-]+)(?=\s|$)/i,a=0,f={},l={manual:s.Prism&&s.Prism.manual,disableWorkerMessageHandler:s.Prism&&s.Prism.disableWorkerMessageHandler,util:{encode:function o(i){return i instanceof S?new S(i.type,o(i.content),i.alias):Array.isArray(i)?i.map(o):i.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(o){return Object.prototype.toString.call(o).slice(8,-1)},objId:function(o){return o.__id||Object.defineProperty(o,"__id",{value:++a}),o.__id},clone:function o(i,c){c=c||{};var d,h;switch(l.util.type(i)){case"Object":if(h=l.util.objId(i),c[h])return c[h];d={},c[h]=d;for(var b in i)i.hasOwnProperty(b)&&(d[b]=o(i[b],c));return d;case"Array":return h=l.util.objId(i),c[h]?c[h]:(d=[],c[h]=d,i.forEach(function(E,v){d[v]=o(E,c)}),d);default:return i}},getLanguage:function(o){for(;o;){var i=n.exec(o.className);if(i)return i[1].toLowerCase();o=o.parentElement}return"none"},setLanguage:function(o,i){o.className=o.className.replace(RegExp(n,"gi"),""),o.classList.add("language-"+i)},currentScript:function(){if(typeof document>"u")return null;if("currentScript"in document)return document.currentScript;try{throw new Error}catch(d){var o=(/at [^(\r\n]*\((.*):[^:]+:[^:]+\)$/i.exec(d.stack)||[])[1];if(o){var i=document.getElementsByTagName("script");for(var c in i)if(i[c].src==o)return i[c]}return null}},isActive:function(o,i,c){for(var d="no-"+i;o;){var h=o.classList;if(h.contains(i))return!0;if(h.contains(d))return!1;o=o.parentElement}return!!c}},languages:{plain:f,plaintext:f,text:f,txt:f,extend:function(o,i){var c=l.util.clone(l.languages[o]);for(var d in i)c[d]=i[d];return c},insertBefore:function(o,i,c,d){d=d||l.languages;var h=d[o],b={};for(var E in h)if(h.hasOwnProperty(E)){if(E==i)for(var v in c)c.hasOwnProperty(v)&&(b[v]=c[v]);c.hasOwnProperty(E)||(b[E]=h[E])}var I=d[o];return d[o]=b,l.languages.DFS(l.languages,function(R,X){X===I&&R!=o&&(this[R]=b)}),b},DFS:function o(i,c,d,h){h=h||{};var b=l.util.objId;for(var E in i)if(i.hasOwnProperty(E)){c.call(i,E,i[E],d||E);var v=i[E],I=l.util.type(v);I==="Object"&&!h[b(v)]?(h[b(v)]=!0,o(v,c,null,h)):I==="Array"&&!h[b(v)]&&(h[b(v)]=!0,o(v,c,E,h))}}},plugins:{},highlightAll:function(o,i){l.highlightAllUnder(document,o,i)},highlightAllUnder:function(o,i,c){var d={callback:c,container:o,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};l.hooks.run("before-highlightall",d),d.elements=Array.prototype.slice.apply(d.container.querySelectorAll(d.selector)),l.hooks.run("before-all-elements-highlight",d);for(var h=0,b;b=d.elements[h++];)l.highlightElement(b,i===!0,d.callback)},highlightElement:function(o,i,c){var d=l.util.getLanguage(o),h=l.languages[d];l.util.setLanguage(o,d);var b=o.parentElement;b&&b.nodeName.toLowerCase()==="pre"&&l.util.setLanguage(b,d);var E=o.textContent,v={element:o,language:d,grammar:h,code:E};function I(X){v.highlightedCode=X,l.hooks.run("before-insert",v),v.element.innerHTML=v.highlightedCode,l.hooks.run("after-highlight",v),l.hooks.run("complete",v),c&&c.call(v.element)}if(l.hooks.run("before-sanity-check",v),b=v.element.parentElement,b&&b.nodeName.toLowerCase()==="pre"&&!b.hasAttribute("tabindex")&&b.setAttribute("tabindex","0"),!v.code){l.hooks.run("complete",v),c&&c.call(v.element);return}if(l.hooks.run("before-highlight",v),!v.grammar){I(l.util.encode(v.code));return}if(i&&s.Worker){var R=new Worker(l.filename);R.onmessage=function(X){I(X.data)},R.postMessage(JSON.stringify({language:v.language,code:v.code,immediateClose:!0}))}else I(l.highlight(v.code,v.grammar,v.language))},highlight:function(o,i,c){var d={code:o,grammar:i,language:c};if(l.hooks.run("before-tokenize",d),!d.grammar)throw new Error('The language "'+d.language+'" has no grammar.');return d.tokens=l.tokenize(d.code,d.grammar),l.hooks.run("after-tokenize",d),S.stringify(l.util.encode(d.tokens),d.language)},tokenize:function(o,i){var c=i.rest;if(c){for(var d in c)i[d]=c[d];delete i.rest}var h=new G;return M(h,h.head,o),k(o,h,i,h.head,0),J(h)},hooks:{all:{},add:function(o,i){var c=l.hooks.all;c[o]=c[o]||[],c[o].push(i)},run:function(o,i){var c=l.hooks.all[o];if(!(!c||!c.length))for(var d=0,h;h=c[d++];)h(i)}},Token:S};s.Prism=l;function S(o,i,c,d){this.type=o,this.content=i,this.alias=c,this.length=(d||"").length|0}S.stringify=function o(i,c){if(typeof i=="string")return i;if(Array.isArray(i)){var d="";return i.forEach(function(I){d+=o(I,c)}),d}var h={type:i.type,content:o(i.content,c),tag:"span",classes:["token",i.type],attributes:{},language:c},b=i.alias;b&&(Array.isArray(b)?Array.prototype.push.apply(h.classes,b):h.classes.push(b)),l.hooks.run("wrap",h);var E="";for(var v in h.attributes)E+=" "+v+'="'+(h.attributes[v]||"").replace(/"/g,"&quot;")+'"';return"<"+h.tag+' class="'+h.classes.join(" ")+'"'+E+">"+h.content+"</"+h.tag+">"};function A(o,i,c,d){o.lastIndex=i;var h=o.exec(c);if(h&&d&&h[1]){var b=h[1].length;h.index+=b,h[0]=h[0].slice(b)}return h}function k(o,i,c,d,h,b){for(var E in c)if(!(!c.hasOwnProperty(E)||!c[E])){var v=c[E];v=Array.isArray(v)?v:[v];for(var I=0;I<v.length;++I){if(b&&b.cause==E+","+I)return;var R=v[I],X=R.inside,Y=!!R.lookbehind,be=!!R.greedy,Pe=R.alias;if(be&&!R.pattern.global){var we=R.pattern.toString().match(/[imsuy]*$/)[0];R.pattern=RegExp(R.pattern.source,we+"g")}for(var ge=R.pattern||R,L=d.next,q=h;L!==i.tail&&!(b&&q>=b.reach);q+=L.value.length,L=L.next){var ae=L.value;if(i.length>o.length)return;if(!(ae instanceof S)){var re=1,N;if(be){if(N=A(ge,q,o,Y),!N||N.index>=o.length)break;var j=N.index,xe=N.index+N[0].length,K=q;for(K+=L.value.length;j>=K;)L=L.next,K+=L.value.length;if(K-=L.value.length,q=K,L.value instanceof S)continue;for(var Q=L;Q!==i.tail&&(K<xe||typeof Q.value=="string");Q=Q.next)re++,K+=Q.value.length;re--,ae=o.slice(q,K),N.index-=q}else if(N=A(ge,0,ae,Y),!N)continue;var j=N.index,W=N[0],r=ae.slice(0,j),u=ae.slice(j+W.length),y=q+ae.length;b&&y>b.reach&&(b.reach=y);var w=L.prev;r&&(w=M(i,w,r),q+=r.length),$(i,w,re);var T=new S(E,X?l.tokenize(W,X):W,Pe,W);if(L=M(i,w,T),u&&M(i,L,u),re>1){var O={cause:E+","+I,reach:y};k(o,i,c,L.prev,q,O),b&&O.reach>b.reach&&(b.reach=O.reach)}}}}}}function G(){var o={value:null,prev:null,next:null},i={value:null,prev:o,next:null};o.next=i,this.head=o,this.tail=i,this.length=0}function M(o,i,c){var d=i.next,h={value:c,prev:i,next:d};return i.next=h,d.prev=h,o.length++,h}function $(o,i,c){for(var d=i.next,h=0;h<c&&d!==o.tail;h++)d=d.next;i.next=d,d.prev=i,o.length-=h}function J(o){for(var i=[],c=o.head.next;c!==o.tail;)i.push(c.value),c=c.next;return i}if(!s.document)return s.addEventListener&&(l.disableWorkerMessageHandler||s.addEventListener("message",function(o){var i=JSON.parse(o.data),c=i.language,d=i.code,h=i.immediateClose;s.postMessage(l.highlight(d,l.languages[c],c)),h&&s.close()},!1)),l;var P=l.util.currentScript();P&&(l.filename=P.src,P.hasAttribute("data-manual")&&(l.manual=!0));function F(){l.manual||l.highlightAll()}if(!l.manual){var D=document.readyState;D==="loading"||D==="interactive"&&P&&P.defer?document.addEventListener("DOMContentLoaded",F):window.requestAnimationFrame?window.requestAnimationFrame(F):window.setTimeout(F,16)}return l}(t);p.exports&&(p.exports=e),typeof Le<"u"&&(Le.Prism=e),e.languages.markup={comment:{pattern:/<!--(?:(?!<!--)[\s\S])*?-->/,greedy:!0},prolog:{pattern:/<\?[\s\S]+?\?>/,greedy:!0},doctype:{pattern:/<!DOCTYPE(?:[^>"'[\]]|"[^"]*"|'[^']*')+(?:\[(?:[^<"'\]]|"[^"]*"|'[^']*'|<(?!!--)|<!--(?:[^-]|-(?!->))*-->)*\]\s*)?>/i,greedy:!0,inside:{"internal-subset":{pattern:/(^[^\[]*\[)[\s\S]+(?=\]>$)/,lookbehind:!0,greedy:!0,inside:null},string:{pattern:/"[^"]*"|'[^']*'/,greedy:!0},punctuation:/^<!|>$|[[\]]/,"doctype-tag":/^DOCTYPE/i,name:/[^\s<>'"]+/}},cdata:{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,greedy:!0},tag:{pattern:/<\/?(?!\d)[^\s>\/=$<%]+(?:\s(?:\s*[^\s>\/=]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))|(?=[\s/>])))+)?\s*\/?>/,greedy:!0,inside:{tag:{pattern:/^<\/?[^\s>\/]+/,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"special-attr":[],"attr-value":{pattern:/=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/,inside:{punctuation:[{pattern:/^=/,alias:"attr-equals"},{pattern:/^(\s*)["']|["']$/,lookbehind:!0}]}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:[{pattern:/&[\da-z]{1,8};/i,alias:"named-entity"},/&#x?[\da-f]{1,8};/i]},e.languages.markup.tag.inside["attr-value"].inside.entity=e.languages.markup.entity,e.languages.markup.doctype.inside["internal-subset"].inside=e.languages.markup,e.hooks.add("wrap",function(s){s.type==="entity"&&(s.attributes.title=s.content.replace(/&amp;/,"&"))}),Object.defineProperty(e.languages.markup.tag,"addInlined",{value:function(n,a){var f={};f["language-"+a]={pattern:/(^<!\[CDATA\[)[\s\S]+?(?=\]\]>$)/i,lookbehind:!0,inside:e.languages[a]},f.cdata=/^<!\[CDATA\[|\]\]>$/i;var l={"included-cdata":{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,inside:f}};l["language-"+a]={pattern:/[\s\S]+/,inside:e.languages[a]};var S={};S[n]={pattern:RegExp(/(<__[^>]*>)(?:<!\[CDATA\[(?:[^\]]|\](?!\]>))*\]\]>|(?!<!\[CDATA\[)[\s\S])*?(?=<\/__>)/.source.replace(/__/g,function(){return n}),"i"),lookbehind:!0,greedy:!0,inside:l},e.languages.insertBefore("markup","cdata",S)}}),Object.defineProperty(e.languages.markup.tag,"addAttribute",{value:function(s,n){e.languages.markup.tag.inside["special-attr"].push({pattern:RegExp(/(^|["'\s])/.source+"(?:"+s+")"+/\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))/.source,"i"),lookbehind:!0,inside:{"attr-name":/^[^\s=]+/,"attr-value":{pattern:/=[\s\S]+/,inside:{value:{pattern:/(^=\s*(["']|(?!["'])))\S[\s\S]*(?=\2$)/,lookbehind:!0,alias:[n,"language-"+n],inside:e.languages[n]},punctuation:[{pattern:/^=/,alias:"attr-equals"},/"|'/]}}}})}}),e.languages.html=e.languages.markup,e.languages.mathml=e.languages.markup,e.languages.svg=e.languages.markup,e.languages.xml=e.languages.extend("markup",{}),e.languages.ssml=e.languages.xml,e.languages.atom=e.languages.xml,e.languages.rss=e.languages.xml,function(s){var n=/(?:"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n])*')/;s.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:RegExp("@[\\w-](?:"+/[^;{\s"']|\s+(?!\s)/.source+"|"+n.source+")*?"+/(?:;|(?=\s*\{))/.source),inside:{rule:/^@[\w-]+/,"selector-function-argument":{pattern:/(\bselector\s*\(\s*(?![\s)]))(?:[^()\s]|\s+(?![\s)])|\((?:[^()]|\([^()]*\))*\))+(?=\s*\))/,lookbehind:!0,alias:"selector"},keyword:{pattern:/(^|[^\w-])(?:and|not|only|or)(?![\w-])/,lookbehind:!0}}},url:{pattern:RegExp("\\burl\\((?:"+n.source+"|"+/(?:[^\\\r\n()"']|\\[\s\S])*/.source+")\\)","i"),greedy:!0,inside:{function:/^url/i,punctuation:/^\(|\)$/,string:{pattern:RegExp("^"+n.source+"$"),alias:"url"}}},selector:{pattern:RegExp(`(^|[{}\\s])[^{}\\s](?:[^{};"'\\s]|\\s+(?![\\s{])|`+n.source+")*(?=\\s*\\{)"),lookbehind:!0},string:{pattern:n,greedy:!0},property:{pattern:/(^|[^-\w\xA0-\uFFFF])(?!\s)[-_a-z\xA0-\uFFFF](?:(?!\s)[-\w\xA0-\uFFFF])*(?=\s*:)/i,lookbehind:!0},important:/!important\b/i,function:{pattern:/(^|[^-a-z0-9])[-a-z0-9]+(?=\()/i,lookbehind:!0},punctuation:/[(){};:,]/},s.languages.css.atrule.inside.rest=s.languages.css;var a=s.languages.markup;a&&(a.tag.addInlined("style","css"),a.tag.addAttribute("style","css"))}(e),e.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|trait)\s+|\bcatch\s+\()[\w.\\]+/i,lookbehind:!0,inside:{punctuation:/[.\\]/}},keyword:/\b(?:break|catch|continue|do|else|finally|for|function|if|in|instanceof|new|null|return|throw|try|while)\b/,boolean:/\b(?:false|true)\b/,function:/\b\w+(?=\()/,number:/\b0x[\da-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?/i,operator:/[<>]=?|[!=]=?=?|--?|\+\+?|&&?|\|\|?|[?*/~^%]/,punctuation:/[{}[\];(),.:]/},e.languages.javascript=e.languages.extend("clike",{"class-name":[e.languages.clike["class-name"],{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$A-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\.(?:constructor|prototype))/,lookbehind:!0}],keyword:[{pattern:/((?:^|\})\s*)catch\b/,lookbehind:!0},{pattern:/(^|[^.]|\.\.\.\s*)\b(?:as|assert(?=\s*\{)|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally(?=\s*(?:\{|$))|for|from(?=\s*(?:['"]|$))|function|(?:get|set)(?=\s*(?:[#\[$\w\xA0-\uFFFF]|$))|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)\b/,lookbehind:!0}],function:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*(?:\.\s*(?:apply|bind|call)\s*)?\()/,number:{pattern:RegExp(/(^|[^\w$])/.source+"(?:"+(/NaN|Infinity/.source+"|"+/0[bB][01]+(?:_[01]+)*n?/.source+"|"+/0[oO][0-7]+(?:_[0-7]+)*n?/.source+"|"+/0[xX][\dA-Fa-f]+(?:_[\dA-Fa-f]+)*n?/.source+"|"+/\d+(?:_\d+)*n/.source+"|"+/(?:\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\.\d+(?:_\d+)*)(?:[Ee][+-]?\d+(?:_\d+)*)?/.source)+")"+/(?![\w$])/.source),lookbehind:!0},operator:/--|\+\+|\*\*=?|=>|&&=?|\|\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\.{3}|\?\?=?|\?\.?|[~:]/}),e.languages.javascript["class-name"][0].pattern=/(\b(?:class|extends|implements|instanceof|interface|new)\s+)[\w.\\]+/,e.languages.insertBefore("javascript","keyword",{regex:{pattern:RegExp(/((?:^|[^$\w\xA0-\uFFFF."'\])\s]|\b(?:return|yield))\s*)/.source+/\//.source+"(?:"+/(?:\[(?:[^\]\\\r\n]|\\.)*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}/.source+"|"+/(?:\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.)*\])*\])*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}v[dgimyus]{0,7}/.source+")"+/(?=(?:\s|\/\*(?:[^*]|\*(?!\/))*\*\/)*(?:$|[\r\n,.;:})\]]|\/\/))/.source),lookbehind:!0,greedy:!0,inside:{"regex-source":{pattern:/^(\/)[\s\S]+(?=\/[a-z]*$)/,lookbehind:!0,alias:"language-regex",inside:e.languages.regex},"regex-delimiter":/^\/|\/$/,"regex-flags":/^[a-z]+$/}},"function-variable":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*[=:]\s*(?:async\s*)?(?:\bfunction\b|(?:\((?:[^()]|\([^()]*\))*\)|(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)\s*=>))/,alias:"function"},parameter:[{pattern:/(function(?:\s+(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)?\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\))/,lookbehind:!0,inside:e.languages.javascript},{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$a-z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*=>)/i,lookbehind:!0,inside:e.languages.javascript},{pattern:/(\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*=>)/,lookbehind:!0,inside:e.languages.javascript},{pattern:/((?:\b|\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\w\xA0-\uFFFF]))(?:(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*)\(\s*|\]\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*\{)/,lookbehind:!0,inside:e.languages.javascript}],constant:/\b[A-Z](?:[A-Z_]|\dx?)*\b/}),e.languages.insertBefore("javascript","string",{hashbang:{pattern:/^#!.*/,greedy:!0,alias:"comment"},"template-string":{pattern:/`(?:\\[\s\S]|\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}|(?!\$\{)[^\\`])*`/,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}/,lookbehind:!0,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:e.languages.javascript}},string:/[\s\S]+/}},"string-property":{pattern:/((?:^|[,{])[ \t]*)(["'])(?:\\(?:\r\n|[\s\S])|(?!\2)[^\\\r\n])*\2(?=\s*:)/m,lookbehind:!0,greedy:!0,alias:"property"}}),e.languages.insertBefore("javascript","operator",{"literal-property":{pattern:/((?:^|[,{])[ \t]*)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*:)/m,lookbehind:!0,alias:"property"}}),e.languages.markup&&(e.languages.markup.tag.addInlined("script","javascript"),e.languages.markup.tag.addAttribute(/on(?:abort|blur|change|click|composition(?:end|start|update)|dblclick|error|focus(?:in|out)?|key(?:down|up)|load|mouse(?:down|enter|leave|move|out|over|up)|reset|resize|scroll|select|slotchange|submit|unload|wheel)/.source,"javascript")),e.languages.js=e.languages.javascript,function(){if(typeof e>"u"||typeof document>"u")return;Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);var s="Loading",n=function(P,F){return" Error "+P+" while fetching file: "+F},a=" Error: File does not exist or is empty",f={js:"javascript",py:"python",rb:"ruby",ps1:"powershell",psm1:"powershell",sh:"bash",bat:"batch",h:"c",tex:"latex"},l="data-src-status",S="loading",A="loaded",k="failed",G="pre[data-src]:not(["+l+'="'+A+'"]):not(['+l+'="'+S+'"])';function M(P,F,D){var o=new XMLHttpRequest;o.open("GET",P,!0),o.onreadystatechange=function(){o.readyState==4&&(o.status<400&&o.responseText?F(o.responseText):o.status>=400?D(n(o.status,o.statusText)):D(a))},o.send(null)}function $(P){var F=/^\s*(\d+)\s*(?:(,)\s*(?:(\d+)\s*)?)?$/.exec(P||"");if(F){var D=Number(F[1]),o=F[2],i=F[3];return o?i?[D,Number(i)]:[D,void 0]:[D,D]}}e.hooks.add("before-highlightall",function(P){P.selector+=", "+G}),e.hooks.add("before-sanity-check",function(P){var F=P.element;if(F.matches(G)){P.code="",F.setAttribute(l,S);var D=F.appendChild(document.createElement("CODE"));D.textContent=s;var o=F.getAttribute("data-src"),i=P.language;if(i==="none"){var c=(/\.(\w+)$/.exec(o)||[,"none"])[1];i=f[c]||c}e.util.setLanguage(D,i),e.util.setLanguage(F,i);var d=e.plugins.autoloader;d&&d.loadLanguages(i),M(o,function(h){F.setAttribute(l,A);var b=$(F.getAttribute("data-range"));if(b){var E=h.split(/\r\n?|\n/g),v=b[0],I=b[1]==null?E.length:b[1];v<0&&(v+=E.length),v=Math.max(0,Math.min(v-1,E.length)),I<0&&(I+=E.length),I=Math.max(0,Math.min(I,E.length)),h=E.slice(v,I).join(`
`),F.hasAttribute("data-start")||F.setAttribute("data-start",String(v+1))}D.textContent=h,e.highlightElement(D)},function(h){F.setAttribute(l,k),D.textContent=h})}}),e.plugins.fileHighlight={highlight:function(F){for(var D=(F||document).querySelectorAll(G),o=0,i;i=D[o++];)e.highlightElement(i)}};var J=!1;e.fileHighlight=function(){J||(console.warn("Prism.fileHighlight is deprecated. Use `Prism.plugins.fileHighlight.highlight` instead."),J=!0),e.plugins.fileHighlight.highlight.apply(this,arguments)}}()})($e);var Ne=$e.exports;class ve{static close(){var t;(t=document.getElementById("jsonEditor"))==null||t.remove()}static show(t,e,s=!0){var M;const n=document.getElementById("tools");if(!n)return;(M=document.getElementById("jsonEditor"))==null||M.remove();const a=document.createElement("div"),f=document.createElement("div"),l=document.createElement("div"),S=document.createElement("div"),A=document.createElement("div");n.appendChild(a),a.appendChild(f),a.appendChild(A),a.appendChild(S),a.appendChild(l),a.id="jsonEditor",A.setAttribute("class","console-text"),f.textContent=this.divLine,l.textContent=this.divLine,Ue(S,async $=>this.update(t,$,A,e,s)).updateCode(t)}static async update(t,e,s,n,a){if(e.textContent===null)return;let f=a?e.textContent:t;if(e.innerHTML=Ne.highlight(f,Ne.languages.js,"js"),f===t)return;let l=await n(f);s.textContent=l.messgae}}m(ve,"divLine","--------------------------------------------------------------------------------------------------");const oe=class oe{static async toggleConfigurationDisplay(t){if(t){const e=await oe.getAboutJson();ve.show(e,async s=>oe.updateStatus,!1)}else ve.close()}static async getAbout(){if(this.about!==void 0)return this.about;let t=await this.getAboutJson();try{return JSON.parse(t)}catch(e){const s="Invalid JSON string: "+e;return console.error(s),this.about=[]}}static async getAboutJson(){if(this.aboutJson!==void 0)return this.aboutJson;const t="dist/about.json",e="/public/about.json";return this.aboutJson=await pe.getFile(t),this.aboutJson===""?await pe.getFile(e):this.aboutJson}};m(oe,"aboutJson"),m(oe,"about"),m(oe,"updateStatus",{success:!1,messgae:"Not editable."});let Te=oe;class Ve{static async toggleLessonsDisplay(t){if(t){const e=await ce.getConfigurationJson();let s=async n=>ce.updateConfigurationJson(n);await ve.show(e,s)}else ve.close()}}class ne{static setupTools(){var t,e,s,n,a;(t=document.getElementById("startTrainingBtn"))==null||t.addEventListener("click",()=>ne.startTraining().then()),(e=document.getElementById("startTestingBtn"))==null||e.addEventListener("click",()=>ne.startTesting().then()),(s=document.getElementById("zenGardenBtn"))==null||s.addEventListener("click",()=>ne.zenGardenOnOff().then()),(n=document.getElementById("configurationBtn"))==null||n.addEventListener("click",()=>ne.configurationOnOff().then()),(a=document.getElementById("aboutBtn"))==null||a.addEventListener("click",()=>ne.configOnOff().then())}static async startTraining(){Z.stopTester(),B.clearScreen(),await Z.train(),await ne.startTesting()}static async startTesting(){Z.stopTrainer(),B.clearScreen(),await Z.test()}static async configOnOff(){this.btnOff("configurationBtn","configuration",t=>Ve.toggleLessonsDisplay(t)),this.btnOnOff("aboutBtn","about",t=>Te.toggleConfigurationDisplay(t))}static async configurationOnOff(){this.btnOff("aboutBtn","about",t=>Te.toggleConfigurationDisplay(t)),this.btnOnOff("configurationBtn","configuration",t=>Ve.toggleLessonsDisplay(t))}static async zenGardenOnOff(){this.btnOnOff("zenGardenBtn","zen garden",t=>C.zenGardenOn=t)}static async btnOff(t,e,s){let n=document.getElementById(t);n==null||n.setAttribute("value",e+" off"),s(!1)}static async btnOnOff(t,e,s){let n=document.getElementById(t);(n==null?void 0:n.getAttribute("value"))!==e+" off"?(n==null||n.setAttribute("value",e+" off"),s(!1)):(n==null||n.setAttribute("value",e+" on"),s(!0))}}ne.setupTools();ne.startTesting().then();
